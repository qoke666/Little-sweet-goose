<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SweetBox & Cakes - Telegram Bot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --font-size: 14px;
            --background: #ffffff;
            --background-light: #f8f9fa;
            --foreground: #333333;
            --card: #ffffff;
            --card-foreground: #333333;
            --primary: #FFC0CB;
            --primary-foreground: #333333;
            --primary-dark: #FFB6C1;
            --secondary: #f8f9fa;
            --secondary-foreground: #333333;
            --muted: #f5f5f5;
            --muted-foreground: #666666;
            --accent: #FF91A4;
            --destructive: #dc3545;
            --destructive-foreground: #ffffff;
            --success: #28a745;
            --success-foreground: #ffffff;
            --border: #e9ecef;
            --input-background: #ffffff;
            --input-foreground: #333333;
            --ring: rgba(255, 192, 203, 0.3);
            --radius: 8px;
            --radius-lg: 12px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: var(--background);
            color: var(--foreground);
            max-width: 360px;
            margin: 0 auto;
            min-height: 640px;
            overflow-x: hidden;
        }

        /* Animations */
        @keyframes fade-in-light {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(100%); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slide-right {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .animate-fade-in-light { animation: fade-in-light 0.6s ease-out; }
        .animate-slide-up { animation: slide-up 0.4s ease-out; }
        .animate-slide-right { animation: slide-right 0.3s ease-out; }

        /* Utility classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .cursor-pointer { cursor: pointer; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        .top-0 { top: 0; }
        .right-2 { right: 0.5rem; }
        .left-2 { left: 0.5rem; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        .max-w-sm { max-width: 24rem; }
        .rounded-lg { border-radius: var(--radius); }
        .rounded-full { border-radius: 9999px; }
        .border { border: 1px solid var(--border); }
        .border-b { border-bottom: 1px solid var(--border); }
        .bg-white { background: var(--background); }
        .text-gray-600 { color: var(--muted-foreground); }
        .text-gray-900 { color: var(--foreground); }
        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }
        .transition-all { transition: all 0.2s ease-in-out; }
        .line-clamp-1 { 
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
        }
        .line-clamp-2 { 
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }

        /* Custom components */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border: none;
            border-radius: var(--radius);
            color: var(--primary-foreground);
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(255, 192, 203, 0.4);
        }

        .btn-outline {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--foreground);
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-outline:hover {
            border-color: var(--primary);
            background: rgba(255, 192, 203, 0.1);
        }

        .search-input {
            background: var(--input-background);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--input-foreground);
            padding: 12px 16px;
            width: 100%;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px var(--ring);
        }

        .category-pill {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 20px;
            color: var(--foreground);
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            white-space: nowrap;
            cursor: pointer;
            min-width: 80px;
        }

        .category-pill.active {
            background: var(--primary);
            color: var(--primary-foreground);
            border-color: var(--primary);
        }

        .category-pill:hover {
            border-color: var(--primary);
            background: rgba(255, 192, 203, 0.1);
        }

        .product-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .discount-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: var(--destructive);
            color: var(--destructive-foreground);
            font-size: 11px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            z-index: 10;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 12px;
            backdrop-filter: blur(4px);
        }

        .rating-star {
            color: #ffc107;
            width: 12px;
            height: 12px;
        }

        .cart-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: var(--background);
            z-index: 50;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .cart-overlay.open {
            transform: translateX(0);
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 320px;
            max-width: 85vw;
            height: 100%;
            background: var(--background);
            border-right: 1px solid var(--border);
            z-index: 50;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-menu-item {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--foreground);
            transition: background 0.2s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 15px;
            cursor: pointer;
        }

        .sidebar-menu-item:hover {
            background: var(--secondary);
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
            scroll-behavior: smooth;
        }

        .grid-cols-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
        }

        .icon {
            width: 1.25rem;
            height: 1.25rem;
            fill: currentColor;
        }

        .icon-sm {
            width: 1rem;
            height: 1rem;
        }

        .badge {
            background: var(--primary);
            color: var(--primary-foreground);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 9999px;
            min-width: 1.25rem;
            height: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cart-item {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--background);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quantity-btn {
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--background);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quantity-btn:hover {
            border-color: var(--primary);
            background: rgba(255, 192, 203, 0.1);
        }
    </style>
</head>
<body>
    <!-- Main App Container -->
    <div id="app" class="min-h-screen bg-white">
        <!-- Header -->
        <header id="header" class="bg-white border-b sticky top-0 z-50">
            <div class="flex items-center justify-between px-4 py-3">
                <button id="menu-btn" aria-label="Открыть боковое меню" class="p-2 -ml-2 hover:bg-gray-100 rounded-lg transition-all">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>

                <div class="flex-1 text-center">
                    <div class="flex items-center justify-center gap-1">
                        <svg class="icon-sm text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                        <span class="text-sm font-medium">ул. Сладкая, 12</span>
                    </div>
                </div>

                <button id="cart-btn" class="relative p-2 -mr-2 hover:bg-gray-100 rounded-lg transition-all">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.5 5M7 13l2.5 5m4.5-5a2 2 0 11-4 0 2 2 0 014 0zm7 0a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <span id="cart-badge" class="badge absolute -top-1 -right-1 hidden">0</span>
                </button>
            </div>

            <div class="px-4 pb-3">
                <div class="relative">
                    <svg class="icon-sm absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input id="search-input" type="text" placeholder="Найти десерт" class="search-input pl-10">
                </div>
            </div>
        </header>

        <!-- Categories -->
        <div id="categories" class="bg-white border-b py-3">
            <div class="flex gap-3 px-4 overflow-x-auto no-scrollbar">
                <button class="category-pill active" data-category="all">🧁 Все</button>
                <button class="category-pill" data-category="cakes">🎂 Торты</button>
                <button class="category-pill" data-category="cupcakes">🧁 Капкейки</button>
                <button class="category-pill" data-category="subscription">📦 Подписка</button>
                <button class="category-pill" data-category="new">✨ Новинки</button>
            </div>
        </div>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 bg-white">
            <!-- Products Grid -->
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 id="section-title" class="text-lg font-bold">Сладости</h2>
                    <span id="products-count" class="text-sm text-gray-600">12 товаров</span>
                </div>

                <div id="products-grid" class="grid-cols-2 gap-3">
                    <!-- Products will be inserted here -->
                </div>

                <div id="no-products" class="text-center py-8 hidden">
                    <div class="text-4xl mb-2">🍰</div>
                    <p class="text-gray-600">Ничего не найдено</p>
                    <p class="text-sm text-gray-600 mt-1">Попробуйте изменить запрос</p>
                </div>
            </div>
        </main>

        <!-- Product Detail Modal -->
        <div id="product-detail" class="cart-overlay">
            <div class="min-h-screen bg-white animate-slide-up">
                <div class="sticky top-0 z-50 bg-white border-b">
                    <div class="flex items-center justify-between px-4 py-3">
                        <button id="detail-back-btn" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="flex-1 text-center">
                            <span id="detail-title" class="text-sm font-medium"></span>
                        </div>
                        <div class="w-9"></div>
                    </div>
                </div>

                <div id="detail-content" class="p-4">
                    <!-- Detail content will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Cart Modal -->
        <div id="cart-modal" class="cart-overlay">
            <div class="flex flex-col h-full bg-white">
                <div class="flex items-center justify-between p-4 border-b bg-white">
                    <div class="flex items-center gap-3">
                        <button id="cart-back-btn" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="flex items-center gap-2">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"/>
                            </svg>
                            <span class="font-semibold">Корзина</span>
                            <span id="cart-total-badge" class="badge hidden">0</span>
                        </div>
                    </div>
                    <button id="cart-close-btn" class="p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>

                <div id="cart-content" class="flex-1 overflow-auto">
                    <!-- Cart content will be inserted here -->
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar-overlay" class="sidebar-overlay">
            <div id="sidebar" class="sidebar">
                <div class="flex flex-col h-full">
                    <div class="p-4 border-b bg-white">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 bg-pink-300 rounded-full flex items-center justify-center">
                                    <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <span class="font-medium">+7 (999) 123-45-67</span>
                            </div>
                            <button id="sidebar-close-btn" class="p-2 hover:bg-gray-100 rounded-lg">
                                <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="bg-pink-100 rounded-lg p-3 flex items-center gap-3 border border-pink-300">
                            <div class="w-8 h-8 bg-pink-300 rounded-full flex items-center justify-center">
                                <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12z"/>
                                </svg>
                            </div>
                            <div>
                                <div class="font-medium">52 бонуса</div>
                                <div class="text-xs text-gray-600">Ваш статус 3%</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex-1 py-2 bg-white">
                        <button class="sidebar-menu-item">
                            <svg class="icon mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5-5-5h5v-5a7.5 7.5 0 11-15 0 8.013 8.013 0 014.7-7.292"/>
                            </svg>
                            <span class="flex-1">Уведомления</span>
                            <span class="badge bg-red-500 text-white text-xs">1</span>
                        </button>
                        <button class="sidebar-menu-item">
                            <svg class="icon mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"/>
                            </svg>
                            <span class="flex-1">Мои заказы</span>
                        </button>
                        <button class="sidebar-menu-item">
                            <svg class="icon mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            </svg>
                            <span class="flex-1">Мои адреса</span>
                        </button>
                        <button class="sidebar-menu-item">
                            <svg class="icon mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            <span class="flex-1">Угости друга</span>
                        </button>
                        <div class="sidebar-menu-item">
                            <span class="flex-1">Открыть в Telegram</span>
                            <button onclick="window.open('https://t.me/YourSweetBoxBot?start=webapp', '_blank')" class="btn-primary">Открыть</button>
                        </div>

                        <div class="my-4 h-px bg-gray-200 mx-4"></div>

                        <div class="px-4 mb-2">
                            <span class="text-sm font-medium text-gray-600">Сервисы</span>
                        </div>

                        <button class="sidebar-menu-item">
                            <span class="flex-1">Кондитерские</span>
                        </button>
                        <button class="sidebar-menu-item">
                            <span class="flex-1">Условия доставки</span>
                        </button>
                        <button class="sidebar-menu-item text-pink-500">
                            <span class="flex-1">ЧАТ С ОПЕРАТОРОМ ❤</span>
                        </button>
                    </div>

                    <div class="p-4 border-t bg-white">
                        <div class="flex items-center gap-2 text-xs text-gray-600">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h4a1 1 0 011 1v5m-6 0h6"/>
                            </svg>
                            <span>SweetCake Professional v.1.57.10</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация Telegram Web App
        if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }

        // App State
        const appState = {
            currentView: 'main',
            activeCategory: 'all',
            searchQuery: '',
            cart: [],
            selectedProduct: null
        };

        // Mock Data
        const products = [
            {
                id: '1',
                name: 'Торт "Шоколадный рай"',
                description: 'Нежный шоколадный бисквит с кремом и ягодами',
                price: 1200,
                image: 'https://images.unsplash.com/photo-1578985545062-69928b1d9587?w=400&h=300&fit=crop',
                category: 'cakes',
                rating: 4.8,
                reviewCount: 124,
                isNew: true,
                discount: 15,
                volume: '1 кг',
                ingredients: [
                    'Бисквит шоколадный',
                    'Крем сливочный',
                    'Ягоды свежие',
                    'Шоколадная глазурь',
                    'Сахарная пудра'
                ]
            },
            {
                id: '2',
                name: 'Капкейки "Ванильные"',
                description: 'Воздушные капкейки с ванильным кремом',
                price: 150,
                image: 'https://images.unsplash.com/photo-1587736701009-d4ce8b6ad99b?w=400&h=300&fit=crop',
                category: 'cupcakes',
                rating: 4.6,
                reviewCount: 89,
                isNew: false,
                volume: '1 шт',
                ingredients: [
                    'Ванильный бисквит',
                    'Крем ванильный',
                    'Сахарная пудра'
                ]
            },
            {
                id: '3',
                name: 'SweetBox подписка',
                description: 'Ежемесячная подписка на коробку с десертами',
                price: 2500,
                image: 'https://images.unsplash.com/photo-1606890737304-57a1ca8a5b62?w=400&h=300&fit=crop',
                category: 'subscription',
                rating: 4.9,
                reviewCount: 256,
                isNew: true,
                volume: 'Месяц',
                ingredients: ['Ассорти десертов']
            },
            {
                id: '4',
                name: 'Эклеры классические',
                description: 'Традиционные эклеры с заварным кремом',
                price: 200,
                image: 'https://images.unsplash.com/photo-1486427944299-d1955d23e34d?w=400&h=300&fit=crop',
                category: 'cakes',
                rating: 4.7,
                reviewCount: 67,
                isNew: false,
                volume: '1 шт',
                ingredients: [
                    'Заварное тесто',
                    'Крем заварной',
                    'Шоколадная глазурь'
                ]
            },
            {
                id: '5',
                name: 'Макаруны ассорти',
                description: 'Набор разноцветных макарунов с разными вкусами',
                price: 300,
                image: 'https://images.unsplash.com/photo-1571115764595-644a1f56a55c?w=400&h=300&fit=crop',
                category: 'cupcakes',
                rating: 4.5,
                reviewCount: 43,
                isNew: true,
                discount: 10,
                volume: '6 шт',
                ingredients: [
                    'Миндальная мука',
                    'Сахарная пудра',
                    'Крем ганаш'
                ]
            },
            {
                id: '6',
                name: 'Чизкейк "Нью-Йорк"',
                description: 'Классический американский чизкейк',
                price: 800,
                image: 'https://images.unsplash.com/photo-1524351199678-941a58a3df50?w=400&h=300&fit=crop',
                category: 'cakes',
                rating: 4.9,
                reviewCount: 178,
                isNew: false,
                volume: '800 г',
                ingredients: [
                    'Сливочный сыр',
                    'Песочное тесто',
                    'Сахар'
                ]
            }
        ];

        // DOM Elements
        const elements = {
            menuBtn: document.getElementById('menu-btn'),
            cartBtn: document.getElementById('cart-btn'),
            cartBadge: document.getElementById('cart-badge'),
            searchInput: document.getElementById('search-input'),
            categories: document.querySelectorAll('.category-pill'),
            productsGrid: document.getElementById('products-grid'),
            noProducts: document.getElementById('no-products'),
            sectionTitle: document.getElementById('section-title'),
            productsCount: document.getElementById('products-count'),
            cartModal: document.getElementById('cart-modal'),
            cartBackBtn: document.getElementById('cart-back-btn'),
            cartCloseBtn: document.getElementById('cart-close-btn'),
            cartContent: document.getElementById('cart-content'),
            cartTotalBadge: document.getElementById('cart-total-badge'),
            productDetail: document.getElementById('product-detail'),
            detailBackBtn: document.getElementById('detail-back-btn'),
            detailTitle: document.getElementById('detail-title'),
            detailContent: document.getElementById('detail-content'),
            sidebarOverlay: document.getElementById('sidebar-overlay'),
            sidebar: document.getElementById('sidebar'),
            sidebarCloseBtn: document.getElementById('sidebar-close-btn')
        };

        // Event Listeners
        function initEventListeners() {
            elements.menuBtn.addEventListener('click', toggleSidebar);
            elements.cartBtn.addEventListener('click', openCart);
            elements.cartBackBtn.addEventListener('click', closeCart);
            elements.cartCloseBtn.addEventListener('click', closeCart);
            elements.detailBackBtn.addEventListener('click', closeProductDetail);
            elements.sidebarCloseBtn.addEventListener('click', closeSidebar);
            elements.sidebarOverlay.addEventListener('click', closeSidebar);
            elements.searchInput.addEventListener('input', handleSearch);

            elements.categories.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.categories.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    appState.activeCategory = btn.dataset.category;
                    renderProducts();
                });
            });
        }

        // Sidebar Functions
        function toggleSidebar() {
            elements.sidebarOverlay.classList.add('open');
            elements.sidebar.classList.add('open');
        }

        function closeSidebar() {
            elements.sidebarOverlay.classList.remove('open');
            elements.sidebar.classList.remove('open');
        }

        // Cart Functions
        function openCart() {
            elements.cartModal.classList.add('open');
            renderCart();
        }

        function closeCart() {
            elements.cartModal.classList.remove('open');
        }

        function addToCartById(productId, quantity = 1) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('Продукт не найден', 'error');
                return;
            }
            const existingItem = appState.cart.find(item => item.id === product.id);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                appState.cart.push({ ...product, quantity });
            }
            localStorage.setItem('cart', JSON.stringify(appState.cart));
            updateCartBadge();
            showNotification(`${product.name} добавлен в корзину`, 'success');
        }

        function updateCartQuantity(productId, newQuantity) {
            const item = appState.cart.find(item => item.id === productId);
            if (!item) {
                showNotification('Товар не найден в корзине', 'error');
                return;
            }
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            item.quantity = newQuantity;
            localStorage.setItem('cart', JSON.stringify(appState.cart));
            updateCartBadge();
            renderCart();
        }

        function removeFromCart(productId) {
            appState.cart = appState.cart.filter(item => item.id !== productId);
            localStorage.setItem('cart', JSON.stringify(appState.cart));
            updateCartBadge();
            renderCart();
        }

        function clearCart() {
            appState.cart = [];
            localStorage.removeItem('cart');
            updateCartBadge();
            renderCart();
        }

        function updateCartBadge() {
            const totalItems = appState.cart.reduce((sum, item) => sum + item.quantity, 0);
            if (totalItems > 0) {
                elements.cartBadge.textContent = totalItems > 9 ? '9+' : totalItems;
                elements.cartBadge.classList.remove('hidden');
                elements.cartTotalBadge.textContent = totalItems;
                elements.cartTotalBadge.classList.remove('hidden');
            } else {
                elements.cartBadge.classList.add('hidden');
                elements.cartTotalBadge.classList.add('hidden');
            }
        }

        function renderCart() {
            const cartContent = elements.cartContent;
            const cartItems = appState.cart.map(item => item.id).join(',');
            if (cartContent.dataset.cartItems === cartItems) {
                return;
            }
            cartContent.dataset.cartItems = cartItems;

            if (appState.cart.length === 0) {
                elements.cartContent.innerHTML = `
                    <div class="flex-1 flex flex-col items-center justify-center text-center p-4">
                        <div class="text-gray-600 mb-4">
                            <svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l-1 12H6L5 9z"/>
                            </svg>
                            <p class="text-lg font-medium">Корзина пуста</p>
                            <p class="text-sm">Добавьте вкусные десерты</p>
                        </div>
                        <button onclick="closeCart()" class="btn-primary mt-4">
                            Продолжить покупки
                        </button>
                    </div>
                `;
                return;
            }

            const totalAmount = appState.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const deliveryFee = totalAmount > 2000 ? 0 : 300;
            const finalAmount = totalAmount + deliveryFee;

            elements.cartContent.innerHTML = `
                <div class="flex-1 overflow-auto space-y-3 p-4">
                    ${appState.cart.map(item => `
                        <div class="cart-item">
                            <img src="${item.image}" alt="Десерт ${item.name}" class="w-16 h-16 object-cover rounded-lg flex-shrink-0">
                            <div class="flex-1 min-w-0">
                                <h4 class="line-clamp-1 mb-1 font-medium">${item.name}</h4>
                                <p class="text-sm text-pink-600 font-semibold mb-2">
                                    ${item.price} ₽ × ${item.quantity} = ${item.price * item.quantity} ₽
                                </p>
                                
                                <div class="flex items-center justify-between">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})">
                                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                            </svg>
                                        </button>
                                        <span class="w-8 text-center font-medium">${item.quantity}</span>
                                        <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})">
                                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                            </svg>
                                        </button>
                                    </div>
                                    
                                    <button onclick="removeFromCart('${item.id}')" class="p-2 text-red-500 hover:bg-red-50 rounded-lg">
                                        <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="border-t bg-white p-4 space-y-4">
                    <h3 class="font-semibold">Оформление заказа</h3>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-sm font-medium text-gray-600 mb-1 flex items-center gap-1">
                                <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3a2 2 0 012-2h4a2 2 0 012 2v4m-6 0h6m-6 0l-2 8h10l-2-8"/>
                                </svg>
                                Дата
                            </label>
                            <input type="date" class="search-input" min="${new Date().toISOString().split('T')[0]}" required>
                        </div>
                        
                        <div>
                            <label class="text-sm font-medium text-gray-600 mb-1 block">Время</label>
                            <input type="time" class="search-input" min="09:00" max="21:00" required>
                        </div>
                    </div>

                    <div>
                        <label class="text-sm font-medium text-gray-600 mb-1 flex items-center gap-1">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            </svg>
                            Адрес доставки
                        </label>
                        <input type="text" placeholder="Улица, дом, квартира" class="search-input" required>
                    </div>

                    <div>
                        <label class="text-sm font-medium text-gray-600 mb-1 flex items-center gap-1">
                            <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            Телефон
                        </label>
                        <input type="tel" placeholder="+7 (999) 123-45-67" class="search-input" required>
                    </div>

                    <div class="space-y-2 pt-2">
                        <div class="flex justify-between">
                            <span>Товары (${appState.cart.reduce((sum, item) => sum + item.quantity, 0)})</span>
                            <span>${totalAmount} ₽</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Доставка</span>
                            <span class="${deliveryFee === 0 ? 'text-green-600' : ''}">
                                ${deliveryFee === 0 ? 'Бесплатно' : `${deliveryFee} ₽`}
                            </span>
                        </div>
                        ${totalAmount < 2000 ? '<p class="text-xs text-gray-600">Бесплатная доставка от 2000 ₽</p>' : ''}
                        <div class="flex justify-between font-semibold text-lg pt-2 border-t">
                            <span>Итого</span>
                            <span class="text-pink-600">${finalAmount} ₽</span>
                        </div>
                    </div>

                    <div class="space-y-2 pt-2">
                        <button onclick="checkout()" class="btn-primary w-full h-12 text-base font-semibold">
                            <svg class="icon mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                            </svg>
                            Оплатить ${finalAmount} ₽
                        </button>
                        <div class="grid grid-cols-2 gap-2">
                            <button onclick="clearCart()" class="btn-outline w-full">Очистить</button>
                            <button onclick="closeCart()" class="btn-outline w-full">Продолжить</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Product Detail Functions
        function openProductDetailById(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) {
                showNotification('Продукт не найден', 'error');
                return;
            }
            appState.selectedProduct = product;
            elements.detailTitle.textContent = product.name;
            elements.productDetail.classList.add('open');
            renderProductDetail();
        }

        function closeProductDetail() {
            elements.productDetail.classList.remove('open');
            appState.selectedProduct = null;
            detailQuantity = 1;
        }

        function renderProductDetail() {
            if (!appState.selectedProduct) return;

            const product = appState.selectedProduct;
            const discountedPrice = product.discount 
                ? Math.round(product.price * (1 - product.discount / 100))
                : product | price;

            elements.detailContent.innerHTML = `
                <div class="relative h-64 bg-gray-200 mb-4">
                    <img src="${product.image}" alt="Десерт ${product.name}" class="w-full h-full object-cover rounded-lg">
                    
                    ${product.discount ? `<div class="discount-badge">Скидка -${product.discount}%</div>` : ''}
                    
                    ${product.volume ? `
                        <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm rounded-lg px-3 py-1 border">
                            <span class="text-xs font-medium">${product.volume}</span>
                        </div>
                    ` : ''}
                </div>

                <div class="space-y-4">
                    <div class="flex items-center gap-2">
                        <div class="flex items-center gap-1">
                            <svg class="rating-star w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                            </svg>
                            <span class="font-semibold">${product.rating}</span>
                        </div>
                        <span class="text-gray-600">${product.reviewCount} оценок</span>
                    </div>

                    <h1 class="text-xl font-bold">${product.name}</h1>

                    <div class="space-y-2">
                        <h3 class="font-semibold">Размер</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <button class="p-3 rounded-lg border border-pink-300 bg-pink-50 text-left">
                                <div class="font-medium">Маленький</div>
                                <div class="text-sm text-gray-600">${product.price} ₽</div>
                            </button>
                            <button class="p-3 rounded-lg border hover:border-pink-300 text-left">
                                <div class="font-medium">Средний</div>
                                <div class="text-sm text-gray-600">+200 ₽</div>
                            </button>
                        </div>
                    </div>

                    <div>
                        <p class="text-gray-600">${product.description}</p>
                    </div>

                    <div class="space-y-2">
                        <button class="flex items-center justify-between w-full py-2 text-left" onclick="toggleIngredients()">
                            <span class="font-semibold">Состав и пищевая ценность</span>
                            <svg id="ingredients-chevron" class="w-5 h-5 text-gray-600 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </button>
                        
                        <div id="ingredients-list" class="space-y-1 hidden animate-fade-in-light">
                            ${product.ingredients ? product.ingredients.map(ing => `
                                <div class="text-sm text-gray-600">• ${ing}</div>
                            `).join('') : '<div class="text-sm text-gray-600">Информация о составе отсутствует</div>'}
                        </div>
                    </div>

                    <div class="space-y-4 pt-4">
                        <div class="flex items-center justify-center gap-4">
                            <button class="quantity-btn" onclick="changeDetailQuantity(-1)">
                                <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"/>
                                </svg>
                            </button>
                            <span id="detail-quantity" class="font-semibold text-lg">1</span>
                            <button class="quantity-btn" onclick="changeDetailQuantity(1)">
                                <svg class="icon-sm" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                </svg>
                            </button>
                        </div>

                        <button onclick="addToCartFromDetail()" class="btn-primary w-full h-12 text-base font-semibold">
                            Добавить <span id="detail-total-price">${product.price}</span> ₽
                        </button>
                    </div>
                </div>
            `;
        }

        // Search Function
        function handleSearch(e) {
            appState.searchQuery = e.target.value;
            renderProducts();
        }

        // Product Functions
        function getFilteredProducts() {
            let filtered = products;

            if (appState.searchQuery.trim()) {
                const query = appState.searchQuery.trim().toLowerCase().split(/\s+/);
                filtered = filtered.filter(product =>
                    query.some(q =>
                        product.name.toLowerCase().includes(q) ||
                        product.description.toLowerCase().includes(q)
                    )
                );
            }

            if (appState.activeCategory !== 'all') {
                if (appState.activeCategory === 'new') {
                    filtered = filtered.filter(product => product.isNew);
                } else {
                    filtered = filtered.filter(product => product.category === appState.activeCategory);
                }
            }

            return filtered;
        }

        function renderProducts() {
            requestAnimationFrame(() => {
                const filteredProducts = getFilteredProducts();
                
                if (appState.activeCategory === 'all' && !appState.searchQuery) {
                    elements.sectionTitle.textContent = 'Сладости';
                } else if (appState.searchQuery) {
                    elements.sectionTitle.textContent = `Поиск: "${appState.searchQuery}"`;
                } else {
                    const categoryNames = {
                        'cakes': 'Торты',
                        'cupcakes': 'Капкейки',
                        'subscription': 'Подписка',
                        'new': 'Новинки'
                    };
                    elements.sectionTitle.textContent = categoryNames[appState.activeCategory] || 'Сладости';
                }

                elements.productsCount.textContent = `${filteredProducts.length} товаров`;

                if (filteredProducts.length === 0) {
                    elements.productsGrid.classList.add('hidden');
                    elements.noProducts.classList.remove('hidden');
                    return;
                }

                elements.productsGrid.classList.remove('hidden');
                elements.noProducts.classList.add('hidden');

                elements.productsGrid.innerHTML = filteredProducts.map(product => {
                    const discountedPrice = product.discount 
                        ? Math.round(product.price * (1 - product.discount / 100))
                        : product.price;

                    return `
                        <div class="product-card animate-fade-in-light" onclick="openProductDetailById('${product.id}')">
                            <div class="relative h-32 bg-gray-200 overflow-hidden">
                                <img src="${product.image}" alt="Десерт ${product.name}" class="w-full h-full object-cover">
                                
                                ${product.discount ? `<div class="discount-badge">-${product.discount}%</div>` : ''}
                                ${product.isNew ? '<div class="absolute top-2 left-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">NEW</div>' : ''}
                                
                                <div class="rating-display absolute top-2 right-2">
                                    <svg class="rating-star w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                    <span class="rating-text">${product.rating}</span>
                                </div>

                                <button onclick="addToCartById('${product.id}'); event.stopPropagation();" class="absolute bottom-2 right-2 bg-pink-300 hover:bg-pink-400 text-gray-800 p-2 rounded-full shadow-lg transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                </button>
                            </div>

                            <div class="p-3">
                                <div class="flex items-start justify-between gap-2 mb-2">
                                    <div class="flex-1 min-w-0">
                                        <h3 class="font-semibold text-sm line-clamp-1 mb-1">${product.name}</h3>
                                        ${product.volume ? `<p class="text-xs text-gray-600">${product.volume}</p>` : ''}
                                    </div>
                                </div>

                                <p class="text-xs text-gray-600 line-clamp-2 mb-3">${product.description}</p>

                                <div class="flex items-center gap-1 mb-2">
                                    <svg class="rating-star w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
                                    </svg>
                                    <span class="text-xs font-medium">${product.rating}</span>
                                    <span class="text-xs text-gray-600">(${product.reviewCount})</span>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex flex-col">
                                        ${product.discount ? `
                                            <span class="text-xs text-gray-600 line-through">${product.price} ₽</span>
                                            <span class="font-bold">от ${discountedPrice} ₽</span>
                                        ` : `
                                            <span class="font-bold">от ${product.price} ₽</span>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            });
        }

        // Utility Functions
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-lg text-white font-medium animate-fade-in-light ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 
                'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function checkout() {
            const dateInput = document.querySelector('input[type="date"]');
            const timeInput = document.querySelector('input[type="time"]');
            const addressInput = document.querySelector('input[type="text"]');
            const phoneInput = document.querySelector('input[type="tel"]');

            if (!dateInput.value || !timeInput.value || !addressInput.value || !phoneInput.value) {
                showNotification('Заполните все поля для оформления заказа', 'error');
                return;
            }

            const phoneRegex = /^\+?\d{10,12}$/;
            if (!phoneRegex.test(phoneInput.value)) {
                showNotification('Некорректный номер телефона', 'error');
                return;
            }

            const totalAmount = appState.cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const deliveryFee = totalAmount > 2000 ? 0 : 300;
            const finalAmount = totalAmount + deliveryFee;

            const telegram = window.Telegram?.WebApp;
            const user = telegram?.initDataUnsafe?.user || {};
            const user_id = user.id || 'unknown';
            const username = user.username || '';
            const first_name = user.first_name || '';
            const last_name = user.last_name || '';

            const orderData = {
                event: 'order_submit',
                user_id: user_id,
                username: username,
                first_name: first_name,
                last_name: last_name,
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                additional: {
                    order_id: `ORDER_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
                    order_details: appState.cart.map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    total_amount: totalAmount,
                    delivery_fee: deliveryFee,
                    final_amount: finalAmount,
                    date: dateInput.value,
                    time: timeInput.value,
                    address: addressInput.value,
                    phone: phoneInput.value
                }
            };

            fetch('https://script.google.com/macros/s/AKfycbxRK9cnnKCBM4AypS_cPFlYWkowUfBRiwFHbHYBcWNREHuy25nx1JvUVatPtVk1BzU_Mw/exec', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData),
                mode: 'no-cors'
            })
                .then(() => {
                    showNotification('Заказ отправлен! Мы свяжемся с вами в ближайшее время.', 'success');
                    clearCart();
                    closeCart();
                })
                .catch(error => {
                    console.error(`Error sending order: ${error.message}`);
                    showNotification('Ошибка при отправке заказа. Попробуйте еще раз.', 'error');
                });
        }

        // Detail page functions
        let detailQuantity = 1;

        function changeDetailQuantity(change) {
            detailQuantity = Math.max(1, detailQuantity + change);
            document.getElementById('detail-quantity').textContent = detailQuantity;
            
            if (appState.selectedProduct) {
                const totalPrice = appState.selectedProduct.price * detailQuantity;
                document.getElementById('detail-total-price').textContent = totalPrice;
            }
        }

        function addToCartFromDetail() {
            if (appState.selectedProduct) {
                addToCartById(appState.selectedProduct.id, detailQuantity);
                closeProductDetail();
                detailQuantity = 1;
            }
        }

        function toggleIngredients() {
            const list = document.getElementById('ingredients-list');
            const chevron = document.getElementById('ingredients-chevron');
            
            if (list.classList.contains('hidden')) {
                list.classList.remove('hidden');
                chevron.style.transform = 'rotate(180deg)';
            } else {
                list.classList.add('hidden');
                chevron.style.transform = 'rotate(0deg)';
            }
        }

        // Initialize App
        function init() {
            const savedCart = localStorage.getItem('cart');
            if (savedCart) {
                appState.cart = JSON.parse(savedCart);
            }
            initEventListeners();
            renderProducts();
            updateCartBadge();
        }

        // Start the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
